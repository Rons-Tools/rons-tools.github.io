<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ron's Regex Builder for Notepad++</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background-color: #F2F2F2; color: #000; }
    .section { margin-bottom: 20px; }
    .row { display: flex; align-items: center; margin-bottom: 5px; padding: 5px; border-radius: 4px; }
    .row:nth-child(odd) { background-color: #E0E0E0; }
    .row:nth-child(even) { background-color: #D0D0D0; }
    .field { display: flex; align-items: center; margin-right: 5px; }
    select, input[type=text] { margin-right: 5px; }
    button { padding: 6px 12px; margin-right: 5px; }
    .deleteBtn { background: #000; color: white; border: none; cursor: pointer; }
    .addRowBtn { margin-top: 5px; background: #D9534F; color: white; border: none; cursor: pointer; }
    .advanced { border: 1px solid #000; padding: 10px; border-radius: 6px; margin-top: 10px; background-color: #C0C0C0; }
    .cheatsheet { font-size: 0.9em; background: #A0A0A0; padding: 10px; border-radius: 6px; color: #FFF; }
    input, select { background-color: #FFF; color: #000; }
  </style>
</head>
<body>
  <h2>Ron's Regex Builder for Notepad++</h2>

  <div id="rows" class="section">
    <div class="row" data-locked="false">
      <div class="field">
        <input type="text" class="text" />
        <select class="opSelect">
          <option value="">--</option>
          <option value="and">AND</option>
          <option value="or">OR</option>
        </select>
        <button class="deleteBtn">X</button>
      </div>
    </div>
    <div class="row" data-locked="true">
      <button class="addRowBtn">+</button>
    </div>
  </div>

  <div class="section">
    <button id="copyBtn">Copy</button>
  </div>

  <div class="section">
    <textarea id="output" rows="3" style="width:100%;"></textarea>
  </div>

  <div class="section">
    <button onclick="toggleAdv()">Toggle Advanced</button>
    <div id="adv" class="advanced" style="display:none;">
      <h3>Advanced Options</h3>
      <label><input type="checkbox" id="useWordBoundaries" /> Use word boundaries (\b)</label><br/>
      <label><input type="checkbox" id="escapeSpecial" /> Escape special regex characters</label><br/>
    </div>
  </div>

  <div class="section cheatsheet">
    <h3>Regex Cheatsheet</h3>
    <ul>
      <li><code>^</code> = start of line</li>
      <li><code>$</code> = end of line</li>
      <li><code>.</code> = any character</li>
      <li><code>*</code> = 0 or more</li>
      <li><code>+</code> = 1 or more</li>
      <li><code>?</code> = optional</li>
      <li><code>()</code> = group</li>
      <li><code>[]</code> = character set</li>
      <li><code>\b</code> = word boundary</li>
      <li><code>|</code> = OR</li>
    </ul>
  </div>

  <script>
    function esc(str) {
      return str.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
    }

    function generateRegex() {
      const rows = Array.from(document.querySelectorAll('#rows .row')).filter(r => r.dataset.locked === 'false');
      const word = document.getElementById('useWordBoundaries').checked;
      const escSpecial = document.getElementById('escapeSpecial').checked;

      let regexSections = [];

      rows.forEach(row => {
        const fields = Array.from(row.querySelectorAll('.field'));
        let sectionParts = [];

        fields.forEach(f => {
          const text = f.querySelector('.text').value.trim();
          const op = f.querySelector('.opSelect').value;
          if (!text) return;
          const pattern = escSpecial ? esc(text) : text;
          sectionParts.push(pattern);
        });

        if (sectionParts.length) {
          let rowRegex = sectionParts[0];
          for (let j = 1; j < sectionParts.length; j++) {
            rowRegex += '.*' + sectionParts[j];
          }
          regexSections.push(rowRegex);
        }
      });

      let finalRegex = regexSections.join('|');
      if (word) finalRegex = '\\b' + finalRegex + '\\b';
      document.getElementById('output').value = finalRegex;
    }

    const rowsContainer = document.getElementById('rows');

    rowsContainer.addEventListener('click', e => {
      const row = e.target.closest('.row');
      if (!row) return;

      if (e.target.classList.contains('addRowBtn')) {
        if (row.dataset.locked === 'true') {
          row.dataset.locked = 'false';
          row.innerHTML = `<div class="field">
              <input type="text" class="text" />
              <select class="opSelect">
                <option value="">--</option>
                <option value="and">AND</option>
                <option value="or">OR</option>
              </select>
              <button class="deleteBtn">X</button>
            </div>`;
          const newLockedRow = document.createElement('div');
          newLockedRow.className = 'row';
          newLockedRow.dataset.locked = 'true';
          newLockedRow.innerHTML = '<button class="addRowBtn">+</button>';
          rowsContainer.appendChild(newLockedRow);
          generateRegex();
        }
      }

      if (e.target.classList.contains('deleteBtn')) {
        const field = e.target.closest('.field');
        field.remove();
        generateRegex();
      }
    });

    rowsContainer.addEventListener('change', e => {
      if (e.target.classList.contains('opSelect')) {
        const field = e.target.closest('.field');
        const val = e.target.value;
        if (val === 'and' || val === 'or') {
          const nextField = field.nextElementSibling;
          if (!nextField || !nextField.classList.contains('field')) {
            const newField = field.cloneNode(true);
            newField.querySelector('.text').value = '';
            newField.querySelector('.opSelect').value = '';
            field.parentNode.appendChild(newField);
          }
        }
        generateRegex();
      }
    });

    rowsContainer.addEventListener('input', generateRegex);
    document.getElementById('useWordBoundaries').addEventListener('change', generateRegex);
    document.getElementById('escapeSpecial').addEventListener('change', generateRegex);

    document.getElementById('copyBtn').addEventListener('click', () => {
      const out = document.getElementById('output');
      out.select();
      document.execCommand('copy');
    });

    generateRegex();

    function toggleAdv() {
      const adv = document.getElementById('adv');
      adv.style.display = adv.style.display === 'none' ? 'block' : 'none';
    }
  </script>
</body>
</html>
