<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Ron's Regex Builder for Notepad++</title>
  <style>
    body { font-family: Arial; padding: 20px; background: #f2f2f2; }
    .row { display: flex; padding: 5px; background: #ddd; margin-bottom: 5px; }
    .field { display: flex; align-items: center; margin-right: 10px; }
    input { margin-right: 5px; }
    select { margin-right: 5px; }
    button { padding: 4px 10px; }
    .addRowBtn { background: #c33; color: #fff; border: none; cursor: pointer; }
    .deleteBtn { background: #000; color: #fff; border: none; cursor: pointer; }
  </style>
</head>
<body>

<h2 style="color:#c33;">Ron's Regex Builder for Notepad++</h2>

<div id="rows"></div>
<button id="addRow" class="addRowBtn">+</button>

<h3>Output</h3>
<textarea id="output" style="width:100%; height:60px;"></textarea>

<script>
// Simpler, reliable field creator
function createField() {
  const f = document.createElement('div');
  f.className = 'field';
  f.innerHTML = `
    <input type="text" class="txt" placeholder="text" />
    <select class="op">
      <option value="--">--</option>
      <option value="AND">AND</option>
      <option value="OR">OR</option>
    </select>
    <button class="deleteBtn">X</button>
  `;
  return f;
}

// Add a new row (one row = horizontal expression)
function addRow() {
  const row = document.createElement('div');
  row.className = 'row';
  row.appendChild(createField());
  document.getElementById('rows').appendChild(row);
  generate();
}

document.getElementById('addRow').onclick = addRow;

// Click handlers for delete & auto-add field
rows.onclick = function(e) {
  if (e.target.classList.contains('deleteBtn')) {
    const r = e.target.closest('.row');
    e.target.closest('.field').remove();
    if (!r.querySelector('.field')) r.remove();
    generate();
  }

  if (e.target.classList.contains('op')) return;
};

// CHANGE handler for dropdown -> add next field on AND/OR
rows.onchange = function(e) {
  if (e.target.classList.contains('op')) {
    const field = e.target.closest('.field');
    if (e.target.value !== '--') {
      const next = field.nextElementSibling;
      if (!next) field.parentNode.appendChild(createField());
    }
    generate();
  }
};

rows.oninput = generate;

// Core simplified AND/OR grouping logic
function generate() {
  const rowList = [...document.querySelectorAll('.row')];
  let finalParts = [];

  for (const row of rowList) {
    const texts = [...row.querySelectorAll('.txt')].map(i => i.value.trim()).filter(t => t);
    const ops   = [...row.querySelectorAll('.op')].map(o => o.value);

    if (!texts.length) continue;

    // Detect OR indexes
    let orIdx = [];
    ops.forEach((op, i) => { if (op === 'OR') orIdx.push(i); });

    // No OR â†’ simple AND chain: a.*b.*c
    if (orIdx.length === 0) {
      finalParts.push(texts.join('.*'));
      continue;
    }

    // Option A logic: one big OR group
    let first = orIdx[0];
    let last  = orIdx[orIdx.length - 1];

    let pre  = texts.slice(0, first);
    let mid  = texts.slice(first, last + 2); // group spans first..last+1
    let post = texts.slice(last + 2);

    let built = '';
    if (pre.length) built += pre.join('.*') + '.*';
    built += '(' + mid.join('|') + ')';
    if (post.length) built += '.*' + post.join('.*');

    finalParts.push(built);
  }

  document.getElementById('output').value = finalParts.join('|');
}

// Initialize with one row
addRow();
</script>
<div style="background:#888; padding:10px; border-radius:6px; margin-top:20px; color:white;">
  <h3>Regex Cheatsheet</h3>
  <ul>
    <li><code>^</code> = start of line</li>
    <li><code>$</code> = end of line</li>
    <li><code>.</code> = any character</li>
    <li><code>*</code> = 0 or more</li>
    <li><code>+</code> = 1 or more</li>
    <li><code>?</code> = optional</li>
    <li><code>()</code> = group</li>
    <li><code>[]</code> = character set</li>
    <li><code>\b</code> = word boundary</li>
    <li><code>|</code> = OR</li>
  </ul>
</div>

</body>
</html>

